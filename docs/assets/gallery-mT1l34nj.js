import"./modulepreload-polyfill-B5Qt9EMX.js";import{createClient as h}from"https://esm.sh/@supabase/supabase-js@2";const c="https://fwcdxvnpcpyxywbjwyaa.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Y2R4dm5wY3B5eHl3Ymp3eWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTg5NjMsImV4cCI6MjA3MzU3NDk2M30.XEfxRw39wp5jMs3YWFszhFZ1_ZXOilraSBN8R1e3LOI",r="gallerybucket",i="",l=h(c,d);class p{constructor(){this.container=document.getElementById("conveyor"),this.emptyMessage=document.getElementById("empty"),this.loadingMessage=document.getElementById("loading"),this.photos=[],this.currentIndex=0,this.updateInterval=null,this.init()}async init(){await this.loadPhotos(),this.createConveyor(),this.startAutoScroll(),this.setupGestures(),this.startAutoUpdate()}publicUrl(t){return l.storage.from(r).getPublicUrl(t).data.publicUrl}async loadPhotos(){try{console.log("üì§ Loading photos from Supabase...");const t=await this.fetchAllPhotos();return t.length>0?(this.photos=t,this.loadingMessage.style.display="none",this.emptyMessage.style.display="none",console.log(`üì∑ Loaded ${this.photos.length} photos`),!0):(this.photos.length===0&&(this.loadingMessage.style.display="none",this.emptyMessage.style.display="flex"),!1)}catch(t){return console.error("‚ùå Error loading photos:",t),this.photos.length===0&&(this.loadingMessage.style.display="none",this.emptyMessage.style.display="flex",this.emptyMessage.innerHTML="<h2>Error loading photos</h2><p>Check console for details</p>"),!1}}async fetchAllPhotos(){let t=0,n=[];const e=100;for(;;){const{data:o,error:a}=await l.storage.from(r).list(i,{limit:e,offset:t*e,sortBy:{column:"updated_at",order:"desc"}});if(a){console.error("‚ùå List error:",a);break}if(!(o!=null&&o.length))break;for(const s of o)s.id&&s.name&&n.push({path:i+s.name,name:s.name,url:this.publicUrl(i+s.name),updated:s.updated_at});if(o.length<e)break;t++}return n}createConveyor(){if(this.photos.length===0)return;const t=[...this.photos,...this.photos];t.forEach((e,o)=>{const a=this.createPhotoElement(e,o);this.container.appendChild(a)});const n=400;this.container.style.width=`${t.length*n}px`}createPhotoElement(t,n){const e=document.createElement("div");e.className="photo";const o=document.createElement("img");o.src=t.url,o.alt="AR Photo",o.loading="lazy",e.addEventListener("click",()=>{window.open(t.url,"_blank")});const a=document.createElement("div");a.className="date-overlay";const s=new Date(t.updated||Date.now());return a.textContent=s.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),e.appendChild(o),e.appendChild(a),e}startAutoScroll(){if(this.photos.length===0)return;const n=this.photos.length*400;let e=0;const o=()=>{e+=.5,e>=n&&(e=0),this.container.style.transform=`translateX(-${e}px)`,requestAnimationFrame(o)};o()}setupGestures(){this.container.addEventListener("mouseenter",()=>{this.container.style.animationPlayState="paused"}),this.container.addEventListener("mouseleave",()=>{this.container.style.animationPlayState="running"})}startAutoUpdate(){this.updateInterval=setInterval(async()=>{await this.checkForNewPhotos()},5e3),console.log("üîÑ Auto-update started - checking for new photos every 5 seconds")}async checkForNewPhotos(){try{const t=await this.fetchAllPhotos(),n=new Set(this.photos.map(o=>o.name)),e=t.filter(o=>!n.has(o.name));e.length>0&&(console.log(`üÜï Found ${e.length} new photos, adding to conveyor...`),this.photos=[...e,...this.photos],this.addNewPhotosToConveyor(e),this.emptyMessage.style.display==="flex"&&(this.emptyMessage.style.display="none"))}catch(t){console.error("‚ùå Error checking for new photos:",t)}}addNewPhotosToConveyor(t){t.forEach((o,a)=>{const s=this.createPhotoElement(o,0);s.style.opacity="0",s.style.transform="scale(0.9)",this.container.insertBefore(s,this.container.firstChild),setTimeout(()=>{s.style.transition="all 0.5s ease",s.style.opacity="1",s.style.transform="scale(1)"},a*100)});const e=this.container.children.length;this.container.style.width=`${e*400}px`,console.log(`‚ú® ${t.length} new photos added to front of conveyor`)}}document.addEventListener("DOMContentLoaded",()=>{new p});console.log("üé® Gallery script loaded");
