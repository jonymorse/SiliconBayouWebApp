import{createClient as h}from"https://esm.sh/@supabase/supabase-js@2";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();const d="https://fwcdxvnpcpyxywbjwyaa.supabase.co",p="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3Y2R4dm5wY3B5eHl3Ymp3eWFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTg5NjMsImV4cCI6MjA3MzU3NDk2M30.XEfxRw39wp5jMs3YWFszhFZ1_ZXOilraSBN8R1e3LOI",a="gallerybucket",i="",l=h(d,p);class u{constructor(){this.container=document.getElementById("conveyor"),this.emptyMessage=document.getElementById("empty"),this.loadingMessage=document.getElementById("loading"),this.photos=[],this.currentIndex=0,this.updateInterval=null,this.init()}async init(){await this.loadPhotos(),this.createConveyor(),this.startAutoScroll(),this.setupGestures(),this.startAutoUpdate()}publicUrl(e){return l.storage.from(a).getPublicUrl(e).data.publicUrl}async loadPhotos(){try{console.log("üì§ Loading photos from Supabase...");const e=await this.fetchAllPhotos();return e.length>0?(this.photos=e,this.loadingMessage.style.display="none",this.emptyMessage.style.display="none",console.log(`üì∑ Loaded ${this.photos.length} photos`),!0):(this.photos.length===0&&(this.loadingMessage.style.display="none",this.emptyMessage.style.display="flex"),!1)}catch(e){return console.error("‚ùå Error loading photos:",e),this.photos.length===0&&(this.loadingMessage.style.display="none",this.emptyMessage.style.display="flex",this.emptyMessage.innerHTML="<h2>Error loading photos</h2><p>Check console for details</p>"),!1}}async fetchAllPhotos(){let e=0,r=[];const o=100;for(;;){const{data:t,error:s}=await l.storage.from(a).list(i,{limit:o,offset:e*o,sortBy:{column:"updated_at",order:"desc"}});if(s){console.error("‚ùå List error:",s);break}if(!(t!=null&&t.length))break;for(const n of t)n.id&&n.name&&r.push({path:i+n.name,name:n.name,url:this.publicUrl(i+n.name),updated:n.updated_at});if(t.length<o)break;e++}return r}createConveyor(){if(this.photos.length===0)return;const e=[...this.photos,...this.photos];e.forEach((o,t)=>{const s=this.createPhotoElement(o,t);this.container.appendChild(s)});const r=400;this.container.style.width=`${e.length*r}px`}createPhotoElement(e,r){const o=document.createElement("div");o.className="photo";const t=document.createElement("img");t.src=e.url,t.alt="AR Photo",t.loading="lazy",o.addEventListener("click",()=>{window.open(e.url,"_blank")});const s=document.createElement("div");s.className="date-overlay";const n=new Date(e.updated||Date.now());return s.textContent=n.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),o.appendChild(t),o.appendChild(s),o}startAutoScroll(){if(this.photos.length===0)return;const r=this.photos.length*400;let o=0;const t=()=>{o+=.5,o>=r&&(o=0),this.container.style.transform=`translateX(-${o}px)`,requestAnimationFrame(t)};t()}setupGestures(){this.container.addEventListener("mouseenter",()=>{this.container.style.animationPlayState="paused"}),this.container.addEventListener("mouseleave",()=>{this.container.style.animationPlayState="running"})}startAutoUpdate(){this.updateInterval=setInterval(async()=>{await this.checkForNewPhotos()},5e3),console.log("üîÑ Auto-update started - checking for new photos every 5 seconds")}async checkForNewPhotos(){try{const e=await this.fetchAllPhotos(),r=new Set(this.photos.map(t=>t.name)),o=e.filter(t=>!r.has(t.name));o.length>0&&(console.log(`üÜï Found ${o.length} new photos, adding to conveyor...`),this.photos=[...o,...this.photos],this.addNewPhotosToConveyor(o),this.emptyMessage.style.display==="flex"&&(this.emptyMessage.style.display="none"))}catch(e){console.error("‚ùå Error checking for new photos:",e)}}addNewPhotosToConveyor(e){e.forEach((t,s)=>{const n=this.createPhotoElement(t,0);n.style.opacity="0",n.style.transform="scale(0.9)",this.container.insertBefore(n,this.container.firstChild),setTimeout(()=>{n.style.transition="all 0.5s ease",n.style.opacity="1",n.style.transform="scale(1)"},s*100)});const o=this.container.children.length;this.container.style.width=`${o*400}px`,console.log(`‚ú® ${e.length} new photos added to front of conveyor`)}}document.addEventListener("DOMContentLoaded",()=>{new u});console.log("üé® Gallery script loaded");
